<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head >
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心</title>
    <link href="../static/images/favicon.ico" th:href="@{/images/cquptLOGO.jpg}" rel="icon" type="image/x-ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css">
    <link rel="stylesheet" href="../../static/css/me.css" th:href="@{/css/me.css}">
    <link rel="stylesheet" href="../../static/layui/css/layui.css" th:href="@{/layui/css/layui.css}" media="all" />
    <link rel="stylesheet" href="../../static/css/public.css" th:href="@{/css/public.css}" media="all" />
</head>

<body class="childrenBody">

<!--导航栏-->
<!--导航-->
<nav th:replace="_fragments :: menu(3)" class="ui inverted attached segment m-padded-tb-mini m-shadow-small" >
    <div class="ui container">
        <div class="ui inverted secondary stackable menu">
            <h2 class="ui teal header item">管理后台</h2>
            <a href="#" class="active m-item item m-mobile-hide"><i class="mini home icon"></i>博客</a>
            <a href="#" class=" m-item item m-mobile-hide"><i class="mini idea icon"></i>分类</a>
            <a href="#" class="m-item item m-mobile-hide"><i class="mini tags icon"></i>标签</a>
            <div class="right m-item m-mobile-hide menu">
                <div class="ui dropdown  item">
                    <div class="text">
                        <img class="ui avatar image" id="navbar-img" >
                        <input id="avatarFileName"  type="hidden" th:value="${session.user.avatar}">
                        <span th:text="${session.user.nickname}">刘博文</span>
                    </div>
                    <i class="dropdown icon"></i>
                    <div class="menu">
                        <a th:href="@{/cqupt/logout}" class="item">注销</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a href="#" class="ui menu toggle black icon button m-right-top m-mobile-show">
        <i class="sidebar icon"></i>
    </a>
</nav>

<!--历史记录-->

<!--查询条件-->
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 15px;">
    <legend>搜索条件</legend>
</fieldset>
<form action="" method="post" id="searchFrm" lay-filter="searchFrm" class="layui-form">
    <div class="layui-form-item">
        <div class="layui-input-block" style="text-align: center;padding-right: 15%;">
<!--            <label >论文名称</label>-->

                <input type="text" name="content" id="papername" class="layui-input"
                       placeholder="请输入评论内容">

            <button type="button" class="layui-btn layui-btn-sm layui-btn-radius" lay-submit="" lay-filter="doSearch">
                <i
                    class="layui-icon layui-icon-search layui-icon-normal"></i>查询
            </button>
            <button type="reset" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-warm"><i
                    class="layui-icon layui-icon-refresh"></i><span>重置</span>
            </button>
        </div>
<!--        <div class="layui-input-block" style="text-align: center;padding-right: 15%;">-->

<!--        </div>-->

    </div>
</form>

<!--数据表格-->
<div>
    <table class="layui-hide" id="loginfoTable" lay-filter="loginfoTable"></table>
    <div id="loginfoToolBar" style="display: none">
        <button type="button" lay-event="batchDelete"  class="layui-btn layui-btn-sm layui-btn-danger layui-btn-radius">
            <i class="layui-icon layui-icon-delete"></i>批量删除
        </button>
    </div>
    <div id="loginfoRowBar" style="display: none;">
        <button type="button" lay-event="delete"  class="layui-btn layui-btn-sm layui-btn-danger layui-btn-radius"><i
                class="layui-icon layui-icon-delete"></i>删除
        </button>
    </div>
</div>


<br>
<br>
<br>
<br>


<!--底部栏-->
<footer class="ui inverted vertical segment m-padded-tb-massive m-opacity">
    <!--容器-->
    <div class="ui center aligned container">
        <div class="ui inverted divided stackable grid">
            <div class="three wide column">
                <div class="ui inverted link list">
                    <div class="item">
                        <img src="../static/images/wechat.jpg" th:src="@{/images/wechat.jpg}"  class="ui rounded image" alt="" style="width: 110px">
                    </div>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header m-text-thin m-text-spaced " >重邮友情链接</h4>
                <div class="ui inverted link list">
                    <a href="http://www.cqupt.edu.cn/" class="item m-text-thin">重庆邮电大学</a>
                    <a href="http://cs.cqupt.edu.cn/" class="item m-text-thin">重庆邮电大学-计算机学院</a>
                    <a href="https://tieba.baidu.com/f?kw=%D6%D8%C7%EC%D3%CA%B5%E7%B4%F3%D1%A7&fr=ala0&tpl=5&dyTabStr=MCw2LDMsMiwxLDQsNSw3LDgsOQ%3D%3D" class="item m-text-thin">重庆邮电大学-百度贴吧</a>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header m-text-thin m-text-spaced ">联系开发者</h4>
                <div class="ui inverted link list">
                    <a href="#" class="item m-text-thin">Email：7794262@qq.com</a>
                    <a href="#" class="item m-text-thin">QQ：7794262</a>
                </div>
            </div>
            <div class="seven wide column">
                <h4 class="ui inverted header m-text-thin m-text-spaced ">CQUPT-ACADEMIC</h4>
                <p class="m-text-thin m-text-spaced m-opacity-mini">重庆邮电大学学术交流平台，旨在促进同学论文交流，营造良好的学术氛围。。。。。。</p>
            </div>
        </div>
        <div class="ui inverted section divider"></div>
        <p class="m-text-thin m-text-spaced m-opacity-tiny">Copyright © 2022 LBW Designed in CQUPT</p>
    </div>

</footer>


<!--<script type="text/javascript" src="../../static/layui/layui.js" th:src="@{/layui/layui.js}"></script>-->
<!--/*/<th:block th:replace="admin/_fragments :: script">/*/-->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"></script>
<!--/*/</th:block>/*/-->
<script type="text/javascript" th:src="@{/layui/layui.js}"></script>
<script type="text/javascript" th:src="@{/js/cache.js}"></script>

<script type="text/javascript">
    var fileName=document.getElementById("avatarFileName").value;
    //重新加载头像
    $('#navbar-img').attr('src','/cqupt/file/showImageByName?path='+fileName);
    layui.use(['jquery', 'form', 'layer', 'laydate', 'table'], function () {
        var $ = layui.jquery;
        var upload = layui.upload;
        var form = layui.form;

        //获得当前用户
        var id = $("#id");
        var loginname = $("#username");
        //页面加载完成  得到图像路径
        $.post('/cqupt/user/getUserAvatar',
            id,
            function (res) {
                //拿到绝对路径
                var imgpath = res.data;
                $('#userFace').attr('src','/cqupt/file/showImageByName?path='+imgpath);

            });
        var $ = layui.jquery;
        var form = layui.form;
        var layer = layui.layer;
        var laydate = layui.laydate;
        var table = layui.table;
        //初始化时间选择器
        laydate.render({
            elem: "#startTime",
            type: "datetime"
        });
        laydate.render({
            elem: "#endTime",
            type: "datetime"
        });

        //初始化表格
        var tableIns = table.render({
            elem: "#loginfoTable",
            title: "历史记录数据表格",
            url: "/cqupt/loadAllcommenthistory",
            toolbar: "#loginfoToolBar",
            page: true,
            height: "full-190",
            cols: [ [
                {type: 'checkbox', fixed: 'left'},
                {field: 'id', title: 'ID', align: 'center'},
                {field: 'username', title: '用户名', align: 'center'},
                {field: 'content', title: '评论内容', align: 'center'},
                {field: 'commenttime', title: '评论时间', align: 'center'},
                {fixed: 'right', title: '操作', toolbar: '#loginfoRowBar', align: 'center'}
            ] ],
            done:function (data, curr, count) {
                //不是第一页时，如果当前返回的数据为0那么就返回上一页
                if(data.data.length==0&&curr!=1){
                    tableIns.reload({
                        page:{
                            curr:curr-1
                        }
                    })
                }
            }
        });

        //监控模糊查询按钮事件
        form.on("submit(doSearch)", function (data) {
            tableIns.reload({
                where: data.field,
                page: {
                    curr: 1
                }
            });
            return false;
        });

        //监控工具条事件
        table.on("toolbar(loginfoTable)", function (obj) {
            switch (obj.event) {
                case 'batchDelete':
                    batchDelete();
                    break;
            };
        });

        //监控行工具条事件
        table.on("tool(loginfoTable)",function (obj) {
            //获取当前行数据
            var data = obj.data;
            switch (obj.event){
                case 'delete':
                    deleteInfo(data);
                    break;
            };
        });

        //删除
        function deleteInfo(data) {
            layer.confirm('你确定要删除这条数据吗？',{icon: 3,title:'提示'},function (index) {
                $.post("/cqupt/deleteCommentHistory",{id:data.id},function (res) {
                    if (res.code==200){
                        tableIns.reload({
                            where:"",
                        });
                    }
                    layer.msg(res.msg);
                });
                layer.close(index);
            });
        }

        //批量删除
        function batchDelete() {
            //得到选中行
            var checkStatus = table.checkStatus('loginfoTable');
            var dataLength = checkStatus.data.length;
            if (dataLength>0){
                layer.confirm('你确定要删除这些数据吗？',{icon: 3,title: '提示'},function (index) {
                    //获取选中行数据
                    var data = checkStatus.data;
                    var ids = "";
                    $.each(data,function (index, item) {
                        if (index==0){
                            ids+="ids="+item.id;
                        }else {
                            ids+="&ids="+item.id;
                        }
                    });
                    $.post("/cqupt/batchDeleteCommentHistory",ids,function (res) {
                        if (res.code==200){
                            //重新刷新表格
                            tableIns.reload({
                                where:"",
                            });
                        }
                        layer.msg(res.msg);
                    });
                    layer.close(index);
                });
            }else {
                layer.msg("请选中操作行")
            }
        }


    });

</script>
</body>
</html>